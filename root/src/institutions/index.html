<!--
   retrieveInstitutions() - Pull all of the institutions from the server
   populateInstitutionSelect() - Called from getPrograms() function. Add name, city, and state to the institution list
   displayInstitutionsPage() - Redirects to the selected institution page
   check(form) - confirm before deleting
   removeInstitution() - Remove an institution from the list
   removeAllFilters() - Remove the applied filters
   populateInstitutionStateSelect() - Populate the state dropdown
   sortStateList() - remove duplicates and sort the states
   populateDegrees() - populate the degree dropdowns
   programFilter() - Filter by program type
   
   -->
<script type="text/javascript">
   var institutions = [];
   var programList = [];
   
   /************* Institution Functions **************/
   retrieveInstitutions();
   
   //Gets institutions from the server
   function retrieveInstitutions() 
   {
       let xhr = new XMLHttpRequest();
   
       xhr.open( 'POST', '/institutions' );
       xhr.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
       xhr.onload = function ()
       {
           if ( xhr.status === 200 )
           {
    //           console.log( xhr.responseText );
               let json = JSON.parse( xhr.responseText );
               institutions = json;
               populateInstitutionStateSelect();
               populateInstitutionSelect();
               //populateInstitutionStateSelect();
   
           }
           else
           {
               console.log( `Error retrieving institution list.  Server returned status: ${xhr.start}` );
           }
       };
       xhr.send( '' );
   }
   
     //populate institutions
   function populateInstitutionSelect()        //This function is called from getPrograms function.
       {
           
          let element = document.getElementById('institution');
          //console.log(institutions.length);
          for (var i = 0; i < institutions.length; ++i)
               {
                   
                   let option = document.createElement( 'option' );
                   option.value = institutions[i].id;
                   option.textContent = institutions[i].name + " ("  + institutions[i].city + " , " + institutions[i].state + ")" ;
                   element.appendChild( option );
               }
       }
   
   //Redirects to institution information page
   function displayInstitutionsPage() 
   {
       let select = document.getElementById( 'institution' );
       let institutionId = select.options[select.selectedIndex].value;
       window.location.href = `/institutions/id/${institutionId}/view`;
   }
   
   //Alert before deleting
   function check( form ) 
   {
       return confirm( 'Do you wish to permanently delete the institution?' );
   }
   
   /***************** Delete Selected Institution ***************/
    
   function removeInsitution() 
   {
       let select = document.getElementById( 'institution' );
       let institutionId = select.options[select.selectedIndex].value;
       let xhr = new XMLHttpRequest();
   
       xhr.open( 'PUT', '/institutions/remove' );
       xhr.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
       xhr.onload = function ()
       {
           if ( xhr.status === 200 )
           {
               console.log( xhr.responseText );
               let json = JSON.parse( xhr.responseText );
               if ( json.status && json.count === 1 )
               {
                   select.remove(select.selectedIndex);
               }
   
           }
       };
       xhr.send( `id=${institutionId}` );
   
   }
   
    
    /************** Reset the Filters *************************/
    
    
   function removeAllFilters(){
     clearInstitutions();
     populateInstitutionSelect();
     $("#state").val("-1");
     $("#city").val("-1");
     $("#DegreeType").val("-1");
     $("#InstitutionType").val("-1");
     $("#InstitutionRegionFilter").val("-1");
     document.getElementById("StateF").innerHTML = "";
     document.getElementById("CityF").innerHTML = "";
     document.getElementById("DegreeF").innerHTML = "";
     document.getElementById("InstitutionF").innerHTML = "";
     document.getElementById("RegionF").innerHTML = "";
     //document.getElementById("displayStatus").innerHTML = ""; 
   }
   
   
    /***************** Populate all of the cities ****************/
   //populate city filter
   function populateInstitutionCitySelect() 
   {
       clearSelectCities();
       let select = document.getElementById('state');
       //let stateID = select.options[select.selectedIndex].value;
       let stateName = select.options[select.selectedIndex].text;
   
       let element = document.getElementById('city');
       let option = document.createElement('option');
       option.value = -1;
       //option.textContent = "Select City";
       element.appendChild(option);
       for(var i = 0; i< institutions.length; ++i)
       {
   
           if(institutions[i].state == stateName)
           {
   
               element = document.getElementById('city');
               option = document.createElement('option');
   
               option.value = i;
               option.textContent = institutions[i].city;
               element.appendChild(option);
           }
       }
   }
   
   //clear the cities for each state selected
   function clearSelectCities() 
   {
       let element = document.getElementById('city');
       while(element.firstChild)
       {
           element.removeChild(element.firstChild);
   
       }
   }
    
    //populateInstitutionStateSelect();
                     
                     function populateInstitutionStateSelect()
                     {
                         
                         let element = document.getElementById('state');
                     
                         for(var i=0; i< institutions.length; ++i)
                         {
                             let option = document.createElement ('option');
                     
                             option.value = institutions[i].id;
                             option.textContent = institutions[i].state;
                         console.log(institutions[i].state + " added");
                             element.appendChild(option);
                     
                         }
                         
                         //this part will remove duplicates
                             var repeatState = {};
                     
                             $("select[name='state'] > option").each(function () 
                             {
                                 if(repeatState[this.text] /*|| this.text == ""*/)//removed code will remove blank options in the select 
                                     {
                                         $(this).remove();
                                     }
                                 else 
                                     {
                                         repeatState[this.text] = this.value;
                                     }
                             });
                             
                             //This will do the sorting
                             
                             var lb = document.getElementById('state');
                             arrTexts = new Array();
                     
                             for(i=0; i< lb.length; i++)  
                                 {
                                     arrTexts[i] = lb.options[i].text;
                                 }
                                 arrTexts.sort();
                     
                             for(i=0; i<lb.length; i++)  
                                 {
                                     lb.options[i].text = arrTexts[i];
                                     lb.options[i].value = arrTexts[i];
                                 }
                             //lb.options[0].text = "Select State";
                         
                         
                     }
                     
                     
            
    
     /********************** Remove Institutions From Select ********************/
    
   //clear institution list to prepare for population of filtered institutions
   function clearInstitutions(){
   
       let element = document.getElementById( 'institution' );
       while (element.firstChild) {
           element.removeChild(element.firstChild);
       }
   }
   
   
   /******************* Filter by the location *********************/
   function locationFilter(){
       document.getElementById("StateF").innerHTML = "";
       document.getElementById("CityF").innerHTML = "";
       document.getElementById("DegreeF").innerHTML = "";
       document.getElementById("InstitutionF").innerHTML = "";
       document.getElementById("NameF").innerHTML = "";
   
   
       let selectCity = document.getElementById('city');
       let cityId = selectCity.options[selectCity.selectedIndex].value;
       let cityName = selectCity.options[selectCity.selectedIndex].text;
       let stateName = "";
       var count = 0;
   
       if( cityId == -1){//if city not selected it will work on state
   
           let selectState = document.getElementById('state');
           let optionValue = selectState.options[selectState.selectedIndex].value;
            stateName = selectState.options[selectState.selectedIndex].text;
   
           if(optionValue == -1){ //if state is not selected
               alert("Please Select a State to Filter!");
           }
           else{
               
               document.getElementById("StateF").innerHTML = "State: " + stateName;
               
               clearInstitutions();
               for(var i = 0; i < institutions.length; ++i){
                   if(stateName == institutions[i].state){
                       let element = document.getElementById('institution');
                       let option = document.createElement( 'option' );
                       option.value = institutions[i].id;
                       option.textContent = institutions[i].name +" ( "  + institutions[i].city + ", " + institutions[i].state + ")";
                       element.appendChild( option );
                   }
               }
           }
   
   
       }
       else{ //add city to filter
           let selectState = document.getElementById('state');
           let optionValue = selectState.options[selectState.selectedIndex].value;
           stateName = selectState.options[selectState.selectedIndex].text;
           
           document.getElementById("StateF").innerHTML = "State: " + stateName;
           document.getElementById("CityF").innerHTML = "City: " + cityName;
           clearInstitutions();
           for(var i = 0; i < institutions.length; ++i){
               if(cityName == institutions[i].city){
                   let element = document.getElementById('institution');
                   let option = document.createElement( 'option' );
                   option.value = institutions[i].id;
                   option.textContent = institutions[i].name +" ( "  + institutions[i].city + ", " + institutions[i].state + ")";
                   element.appendChild( option );
               }
           }
       } 
   }
   
     /********************* Degrees ****************************/
   
   function filterDegrees()
   {
       document.getElementById("StateF").innerHTML = "";
       document.getElementById("CityF").innerHTML = "";
       document.getElementById("DegreeF").innerHTML = "";
       document.getElementById("InstitutionF").innerHTML = "";
       document.getElementById("NameF").innerHTML = "";
       let select = document.getElementById('DegreeType');
       let degreeId = select.options[select.selectedIndex].value;
       let degreeName = select.options[select.selectedIndex].text;
       let degreeDisplayName = "";
       
       for (var i=0; i<programList.length; i++)
           {
               if(programList[i].degree.title == degreeName)
                   {
                       for(var j=0; j<institutions.length; j++)
                           {
                               if(institutions[j].id == programList[i].institution.id)
                                   {
                                       //institutions[j].degree.id = programList[i].degree.id;
                                       degreeDisplayName = programList[i].degree.title + " in " + programList[i].title;
                                       institutions[j].degree = programList[i].degree.title;
   //                                        console.log(institutions[j].degree);
                                   }
                           }
                   }
           }
       clearInstitutions();
       document.getElementById("DegreeF").innerHTML = "Degree Type: " + degreeName;
       for(var i=0; i<institutions.length; i++)
           {
               if( degreeName == institutions[i].degree)
                   {
                       let element = document.getElementById('institution');
                       let option = document.createElement('option');
                       option.value = i;
                       option.textContent = institutions[i].name + " - " + degreeDisplayName;
                       element.appendChild(option);
                   }
           }
   }
   
   
   /************************ Search Name ****************************/
   
   function filterByName()
   {
       document.getElementById("StateF").innerHTML = "";
       document.getElementById("CityF").innerHTML = "";
       document.getElementById("DegreeF").innerHTML = "";
       document.getElementById("InstitutionF").innerHTML = "";
       document.getElementById("NameF").innerHTML = "";
       
       let select = document.getElementById('schoolName');//the name searched
       console.log(select);
       document.getElementById("NameF").innerHTML = "Institution Name: " + select.value;//tell the user what filter was applied
       let nameInput = select.value.toUpperCase(); //put the name in all caps to ignore case sensitivity
       //nameInput = nameInput.toUpperCase();
       console.log(nameInput);
       //let institutionDisplayName = "";//how the institution name appears in the choices
       //let newID = null;//have to update the institution id for the correct institution to be pulled when selected
    
   
       clearInstitutions();
       //document.getElementById("NameF").innerHTML = "Institution Name: " + nameInput;
       for(var i=0; i<institutions.length; i++)
           {
               let temp = institutions[i].name;
               console.log(institutions[i].type);
               let tempUpper = temp.toUpperCase();
               if(tempUpper.includes(nameInput))
                   {
                       let element = document.getElementById('institution');
                       let option = document.createElement('option');
                       let chosen = institutions[i].name + " ( " + institutions[i].city + " , " + institutions[i].state + " )";
                       let chosenID = institutions[i].id;
                       option.value = chosenID;
                       option.textContent = chosen;
                       element.appendChild(option);
                   }
           }
       
   }
   
   /****************************************************/
   
</script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<div id="InstitutionsContainer" class="InstitutionsContainer" align="center" style="">
   <div id="PageTitle">
      <h2 align="center">View Institutions</h2>
   </div>
   <div style="min-height: 650px; width: 1100px">
      <div id="institutions" class="institutions" style="float:left;margin: 0px 0px 0px 20px; height: 450px; width:450px">
         <table>
             <tr>
               <br><br>
            </tr> 
            <tr>
               <!-- The list of institutions -->
               <td>
                  <select name="institution" id="institution" class="institution" size="10" style="width:620px; height:300px">
                     
                  </select>
                   <script type="text/javascript"> $('#institution').dblclick(function() {
                        displayInstitutionsPage();
                  });
                  </script>
               </td>
            </tr>
            <!-- -->
            <!-- -->
            <tr align="center">
               <td>
                  <!-- table holding the buttons for selecting, adding and removing an institution -->
                  <table align=center>
                     <tr>
                        <td>
                           <button onclick="displayInstitutionsPage()" class="commonBtn" style="width: 150px">View Details</button>
                        </td>
                        <td>
                           <form action = "/institutions/create"
                           {% if globalAdminRole == user.role.id %}Create Institution{% endif %}>
                           <input type="submit" name="addInstitution" value="Add Institution" onclick="" id="addInstitutionButton" class = "commonBtn" style="width:150px">
                           </form>
                        </td>
                        <td>
                           <input type="submit" name="removeInstitution" value="Remove Institution" onclick="removeInsitution()" id="removeInstitutionButton" class="commonBtn" style="width:150px">
                        </td>
                        <td>
                           <input type="button" id="unapplyFilter" value="Remove Filters" onclick="removeAllFilters()" class="commonBtn" style="width:150px">
                        </td>
                     </tr>
                  </table>
               </td>
            </tr>
         </table>
         
          <ul style="background-color: white; list-style-type:none">
            <li><h3><u>Filters Applied</u></h3></li>
         </ul>

          <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="RegionF"></li>
         </ul>
         <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="StateF"></li>
         </ul>
         <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="CityF"></li>
         </ul>
         <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="DegreeF"></li>
         </ul>
         <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="InstitutionF"></li>
         </ul>
         <ul class="WhatFilter" style="background-color: white; list-style-type:none">
            <li id="NameF"></li>
         </ul>
          
      </div>
      <!-- The Search Filters -->
      <div id="SearchOptions" class="SearchOptions" style="float: right; padding: 10px; margin: 0px 20px 0px 0px; width:350px; height: 450px">
         <h2>Filter By</h2>
          
         <table id="AdvancedOptionTable">
            <!--
               <tr>
                   <th colspan=2 style="align: center"><u>User ID:</u></th>
               </tr>
               <tr>
                   <td>
                        
                       User Name:
                   </td>
                   <td>
                       <input type="text" name="userNameInput" placeholder="User Name">
                   </td>
               </tr>
               <tr>
                   <td></td>
                   <td>
                       <input type="submit" value="Search" name="searchUserButton" id="searchUserButton"><br><br>
                   </td>
               </tr>
               -->
             <tr>
               <th colspan=2 style="align: center"><u>Name</u></th>
            </tr>
             <tr>
                 <td>Institution Name: </td>
                 
                 <td align="center">
                     
            <input type="text" id= "schoolName" name="schoolName" placeholder="Search by name..." class="addUserInput"/>
                 </td>
                 
             </tr>
             <tr>
                 <td colspan="2" align="center">
                 <input type="button" value="Apply Filter" onclick="filterByName()" class="commonBtn"/>
                     </td>
             </tr>
            <tr>
               <th colspan=2 style="align: center"><br><u>Location</u></th>
            </tr>
            <tr>
              <td>  Filter By Region:</td>
              <td><select class="CmbBox" id="InstitutionRegionFilter" onchange="filterByRegion()" style="width:300px" >
                    <option value="-1"> Select Region </option>
                    <option value="1">Western Region</option>
                    <option value="2">North Central Region</option>
                    <option value="3">South Cental Region</option>
                    <option value="4">Central Eastern Region</option>
                    <option value="5">North Eastern Region</option>
                    <option value="6">South East Region</option>
                  </select>
                  <br>
                  </td>
            </tr>
            
            <script type="text/javascript">
              
              function filterByRegion(){
               let select = document.getElementById('InstitutionRegionFilter');
               let optionValue = select.options[select.selectedIndex].value;
               let optionsText = select.options[select.selectedIndex].text;

               if(optionValue == -1){
                   // document.getElementById("displayStatus").innerHTML =  "Please select a Region to Filter"; 
                   console.log("Please select a Region to Filter");
               }

               else{
                   // document.getElementById("displayStatus").innerHTML =  "Region : " +  optionsText; 
                    console.log("Region : " +  optionsText);
                    clearSelectStates();
                    //console.log("cleared all");
                    let state = document.getElementById('state');
                    let stateOption = document.createElement( 'option' );
                    stateOption.value = -1;
                    stateOption.textContent = "Select State";
                    state.appendChild( stateOption );
                    

                            if(optionsText == "Western Region"){
                               populateWesternRegion();
                            }
                            else if(optionsText == "North Central Region"){
                              populateNorthCentralRegion();

                            }
                            else if(optionsText == "South Cental Region"){
                              
                              populateSouthCentralRegion();
                            }
                            else if(optionsText == "Central Eastern Region"){
                                populateCentralEasternRegion();
                            }
                            else if(optionsText == "North Eastern Region"){
                                populateNorthEasternRegion();
                            }
                            else if(optionsText == "South East Region"){
                              populateSouthEastRegion();
                            }
                        }
                   
            
              }

              function clearSelectStates()
              {
                 let element = document.getElementById('state');
                  while(element.firstChild)
                      {
                          element.removeChild(element.firstChild);
                      }
              }

              function populateWesternRegion(){
                   
                    var count = 0; 
                    //  Hard Coding Western States;
                    var westernStates = [];

                    westernStates[0] = "AZ";
                    westernStates[1] = "CA";
                    westernStates[2] = "CO";
                    westernStates[3] = "HI";
                    westernStates[4] = "ID";
                    westernStates[5] = "OR";
                    westernStates[6] = "UT";
                    westernStates[7] = "WA";
                    //clearInstitutions();
                    
                   for(var i=0; i< institutions.length; i++){
                       
                      //console.log(institutions[i].state);

                           if( institutions[i].state != undefined){
                              for(var j=0; j<westernStates.length; j++){
                                  
                                    if( institutions[i].state == westernStates[j]){
                                        
                                        ++count;
                                         document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for Western Region <br><br>Region : Western"  ; 
                                           //addInstitution_at(i);
                                          addState_at(i);
                                    }
                               }
                                
                            }
                         
                    } 
                 }

                 function populateNorthCentralRegion(){

                     
                    var count = 0; 
                    //  Hard Coding Western States;
                    var ncStates = [];

                    ncStates[0] = "IA";
                    ncStates[1] = "IL";
                    ncStates[2] = "IN";
                    ncStates[3] = "MI";
                    ncStates[4] = "MN";
                    ncStates[5] = "MO";
                    ncStates[6] = "ND";
                    ncStates[7] = "NE";
                    ncStates[8] = "OH";
                    ncStates[9] = "SD";
                    ncStates[10] = "WI";

                    //clearInstitutions();

                    for(var i=0; i< institutions.length; i++){
                          
                           if( institutions[i].state != undefined){
                              for(var j=0; j<ncStates.length; j++){
                                 
                                    if( institutions[i].state == ncStates[j]){
                                     
                                        ++count;
                                         document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for North Central Region <br><br> Region : North Central" ; 
                                          // addInstitution_at(i);
                                          addState_at(i);
                                    }
                               }
                             }
                           
                 }
               }

               function populateSouthCentralRegion(){
                    
                    var count = 0; 
                    //  Hard Coding Western States;
                    var scStates = [];

                    scStates[0] = "AR";
                    scStates[1] = "KS";
                    scStates[2] = "LA";
                    scStates[3] = "MS";
                    scStates[4] = "NM";
                    scStates[5] = "OK";
                    scStates[6] = "TX";
                    
                    //clearInstitutions();
                   for(var i=0; i< institutions.length; i++){
                         
                           if( institutions[i].state != undefined){
                              for(var j=0; j<scStates.length; j++){
                                  
                                    if( institutions[i].state == scStates[j]){
                                       
                                        ++count;
                                        
                                        
                                          document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for South Central Region <br><br>Region : South Central" ; 
                                          //addInstitution_at(i);
                                          addState_at(i);
                                    }
                               }
                                
                            }
                         
                    } 
                 }

                 function populateCentralEasternRegion(){
                    
                    var count = 0; 
                    //  Hard Coding Western States;
                    var ceStates = [];

                    ceStates[0] = "DC";
                    ceStates[1] = "DE";
                    ceStates[2] = "KY";
                    ceStates[3] = "MD";
                    ceStates[4] = "NC";
                    ceStates[5] = "VA";
                    ceStates[6] = "WV";
                    
                   //clearInstitutions();
                   for(var i=0; i< institutions.length; i++){
                         
                           if( institutions[i].state != undefined){
                              for(var j=0; j<ceStates.length; j++){
                                  console.log( institutions[i].state);
                                    if( institutions[i].state == ceStates[j]){
                                        
                                        ++count;
                                        
                                        
                                          document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for Central Eastern Region <br><br>Region : Central Eastern" ; 

                                           //addInstitution_at(i);
                                          addState_at(i);

                                    }
                               }
                                
                            }
                         
                    } 
                 }

                 function populateNorthEasternRegion(){
                    

                    var count = 0; 
                    //  Hard Coding Western States;
                    var neStates = [];

                    neStates[0] = "CT";
                    neStates[1] = "MA";
                    neStates[2] = "ME";
                    neStates[3] = "NH";
                    neStates[4] = "NJ";
                    neStates[5] = "NY";
                    neStates[6] = "PA";
                    neStates[7] = "RI";
                    neStates[8] = "VT";
                    
                    //clearInstitutions();
                   for(var i=0; i< institutions.length; i++){
                        
                           if( institutions[i].state != undefined){
                              for(var j=0; j<neStates.length; j++){
                                  
                                    if( institutions[i].state == neStates[j]){
                                        
                                        ++count;
                                         document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for North Eastern Region <br><br>Region : North Eastern" ; 

                                           //addInstitution_at(i);
                                          addState_at(i);

                                    }
                               }
                                
                            }
                         
                    } 
                 }

                 function populateSouthEastRegion(){
                    
                    var count = 0; 
                    //  Hard Coding Western States;
                    var seStates = [];

                    seStates[0] = "AL";
                    seStates[1] = "FL";
                    seStates[2] = "GA";
                    seStates[3] = "PR";
                    seStates[4] = "SC";
                    seStates[5] = "TN";
                  
                    
                    //clearInstitutions();
                   for(var i=0; i< institutions.length; i++){
                          
                           if( institutions[i].state != undefined){
                              for(var j=0; j<seStates.length; j++){
                                 
                                    if( institutions[i].state == seStates[j]){
                                        
                                        ++count;
                                        
                                         document.getElementById("RegionF").innerHTML =  "Found " + count + " Institutions for South East Region <br><br>Region : South East" ; 
                                           //addInstitution_at(i);
                                          addState_at(i);

                                    }
                               }
                                
                            }
                         
                    } 
                 }
                 function addInstitution_at(i)
                 {
                     let element = document.getElementById( 'institution' );
                     let option = document.createElement( 'option' );
                      option.value = institutions[i].id;
                      option.textContent =  institutions[i].name + " - " + " (" + institutions[i].city + ", " +institutions[i].state + ")  ";
                       element.appendChild( option );
                       

                 }

                 function addState_at(st){

                      var stateValue = institutions[st].state;
                      let state = document.getElementById('state');
                      if( $ ('#state option:contains('+ stateValue + ')').length) { //Testing if the state already exits in the select
                           //alert("exits");
                      }
                      else{
                        let stateOption = document.createElement( 'option' );
                        stateOption.value = st;
                         stateOption.textContent = institutions[st].state;
                         state.appendChild( stateOption );
                      }
                       
                }
            </script>
            <tr>
               <td>
                  <!-- Search by state -->
                  State:
               </td>
               <td>
                  <select name="state" id="state" style="width:300px" onchange="populateInstitutionCitySelect()" class="CmbBox">
                     <!-- <option selected value="-1">Select State</option> -->
                  </select>
                  <!-- populate state list -->
                  <script>
                     populateInstitutionStateSelect();
                     
                     function populateInstitutionStateSelect()
                     {
                         let element = document.getElementById('state');
                     
                         for(var i=0; i< institutions.length; ++i)
                         {
                             let option = document.createElement ('option');
                     
                             option.value = institutions[i].id;
                             option.textContent = institutions[i].state;
                             element.appendChild(option);
                     
                         }
                         
                         //this part will remove duplicates
                             var repeatState = {};
                     
                             $("select[name='state'] > option").each(function () 
                             {
                                 if(repeatState[this.text] /*|| this.text == ""*/)//removed code will remove blank options in the select 
                                     {
                                         $(this).remove();
                                     }
                                 else 
                                     {
                                         repeatState[this.text] = this.value;
                                     }
                             });
                             
                             //This will do the sorting
                             
                             var lb = document.getElementById('state');
                             arrTexts = new Array();
                     
                             for(i=0; i<lb.length; i++)  
                                 {
                                     arrTexts[i] = lb.options[i].text;
                                 }
                                 arrTexts.sort();
                     
                             for(i=0; i<lb.length; i++)  
                                 {
                                     lb.options[i].text = arrTexts[i];
                                     lb.options[i].value = arrTexts[i];
                                 }
                             //lb.options[0].text = "Select State";
                         
                         
                     }
                     
                     
                  </script>
               </td>
            </tr>
            <tr>
               <td>
                  City (Optional):
               </td>
               <td>
                  <select id="city" name="city" style="width: 300px" class="CmbBox">
                     <!-- <option selected value="-1">Select City</option> -->
                  </select>
                  <script>
                     var repeatCity = {};
                         
                         $("select[name='city'] > option").each(function () {
                             if(repeatCity[this.text]) 
                             {
                                 $(this).remove();
                             }
                             else 
                             {
                                 repeatCity[this.text] = this.value;
                             }
                         });
                  </script>
               </td>
            </tr>
            <tr>
               <td colspan="2"align="center"><input type="submit" value="Apply Filter" name="searchLocationButton" id="searchLocationButton" onclick="locationFilter()" class="commonBtn"/><br><br></td>
            </tr>
            <tr>
               <th colspan=2 style="align: center"><u>Degree Type</u></th>
            </tr>
            <tr>
               <td>
                  Degree Type:
               </td>
               <td>
                  <select name="DegreeType" id="DegreeType" style="width:300px" class="CmbBox">
                      <option value="-1" ></option>
                  </select>
                  <!-- populate the degree list -->     
                  <script>
                     //populateDegrees();
                
   /************ Get the programs each institution has ************/
   getPrograms();
   //Retrieves from the server and puts everything in the program list array
   function getPrograms() 
   {
   
       let xhr = new XMLHttpRequest();
       xhr.open( 'POST', '/programs' );
       xhr.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
       xhr.onload = function ()
       {
           if ( xhr.status === 200 && xhr.readyState == 4)
           {
                  // console.log( xhr.responseText );
               programList = JSON.parse( xhr.responseText );
                //populateDegrees();
               //alert(programList.length + " script");
               
               
               populateDegrees();
                        function populateDegrees(){
                        
                         let element = document.getElementById('DegreeType');
                     
                         
                     //alert(programList.length);
                         for (var i = 0; i < programList.length; ++i){
                             let optionDegree = document.createElement( 'option' );
                             optionDegree.value = i;
                             optionDegree.textContent = programList[i].degree.title; 
                             console.log(programList[i].degree.title + " added")
                             element.appendChild( optionDegree );           
                         }
                            var repeatDegree = {};
                     
                     $("select[name='DegreeType'] > option").each(function () {
                         if(repeatDegree[this.text]) 
                         {
                             $(this).remove();
                         }
                         else 
                         {
                             repeatDegree[this.text] = this.value;
                         }
                     });
                     }
                  
                     
               
           }
           else
           {
               console.log( `Unable to retrieve Program list.  Server returned status: ${xhr.status}` );
           }
       };
       xhr.send( '' );
   }
        
                  </script>
               </td>
            </tr>
            <tr>
               <td colspan="2" align="center">
                  <input type="submit" value="Apply Filter" name="searchProgramButton" id="searchProgramButton" onclick="filterDegrees()" class="commonBtn"><br><br>
               </td>
            </tr>
             
             <!-- 
            <tr>
               <th colspan=2 style="align: center"><u>Institution Type</u></th>
            </tr>
             
            
            <tr>
               <td>Institution Type:</td>
               <td>
                  <select id="InstitutionType" name="InstitutionType" style="width:300px" onclick="" class="CmbBox">
                  </select>
               </td>
            </tr>
             
             
            <tr>
               <td colspan="2" align="center"><input type="submit" value="Apply Filter" name="InstitutionTypeButton" onclick = "filterByInstitutionType()" class="commonBtn"></td>
            </tr>
              -->
             
         </table>
      </div>
      <!-- end div id="SearchOptions" -->
   </div>
</div>
<!-- div id="InstitutionsContainer" -->
<div id="clear"></div>
<!-- end institutions container -->
<script>
    
    /***********************************************************/
    var ITypeList = [];
    getInstitutionTypes();
    function getInstitutionTypes()
    {
        let types = [];
        let xhr = new XMLHttpRequest();
        xhr.open( 'POST', '/institutionTypes' );
        xhr.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
        xhr.onload = function ()
            {
                if ( xhr.status === 200 && xhr.readyState == 4)
                    {            
                        //console.log( xhr.responseText );
                        ITypeList = JSON.parse( xhr.responseText );
                        console.log(ITypeList);
                        populateITypes();
                    }
                else
                    {
                        console.log( `Unable to retrieve Institution Type list.  Server returned status: ${xhr.status}` );
                    }
            };
       xhr.send( '' );
    }
    
    function populateITypes(){
                     
                         let element = document.getElementById('InstitutionType');
                     
                         let optionDefault = document.createElement( 'option' );
                         optionDefault.value = -1;
                         //optionDefault.textContent = "Select Degree";
                         element.appendChild(optionDefault); 

                         for (var i = 0; i < ITypeList.length; ++i){
                           
                            //console.log(ITypeList.id);
                             let option = document.createElement( 'option' );
                             option.value = ITypeList[i].id;
                             option.textContent = ITypeList[i].name;  
                             element.appendChild( option );           
                         }
                     } 
    
    
   /***********************************************************/ 
    
    
   //Filter by the location
   function programFilter(){
      //let selectProgram = document.getElementById('DegreeType');
      //let programID = selectProgram.options[selectProgram.selectedIndex].value;
      //let programName = selectProgram.options[selectProgram.selectedIndex].text;
      var count = 0;
   
          let selectProgram = document.getElementById('DegreeType');
          let optionValue = selectProgram.options[selectProgram.selectedIndex].value;
          let programName = selectProgram.options[selectProgram.selectedIndex].text;
   
      if(optionValue == -1){ //if state is not selected
              alert("Please Select a Program to Filter!");
          }
          else{
   
              clearInstitutions();
              for(var i = 0; i < institutions.length; ++i){
                  if(programName == institutions[i].state){
                      let element = document.getElementById('institution');
                      let option = document.createElement( 'option' );
                      option.value = institutions[i].id;
                      option.textContent = institutions[i].name +" ( "  + institutions[i].city + ", " + institutions[i].state + ")";
                      element.appendChild( option );
                  }
              }
          }
   
   
   }
</script>