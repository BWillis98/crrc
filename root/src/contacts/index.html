<script type="text/javascript">
  let contacts = {{ contacts }};

  function sortContacts()
  {
    function compareInstitution( i1, i2 )
    {
      if ( i1.name < i2.name ) return -1;
      if ( i1.name > i2.name ) return 1;
      return 0;
    }

    function compareContact( c1, c2 )
    {
      if ( c1.name < c2.name ) return -1;
      if ( c1.name > c2.name ) return 1;

      if ( !isEmpty( c1.institution ) && !isEmpty( c2.institution ) )
      {
        return compareInstitution( c1.institution, c2.institution );
      }
      return 0;
    }

    contacts.sort( compareContact );
  }

  function display( contact )
  {
    let html = `<div style="float:left; width:80%;">
      <a href="/contacts/id/${contact.id}/view">${contact.name}</a>
    </div>
    <div style="float:right; width:20%">
      <form action="/contacts/remove" method="post" onsubmit="return deletePerson( this );">
        <input type="hidden" name="id" value="${contact.id}"/>
        <input type="hidden" name="name" value="${contact.name}"/>
        <input type="submit" value="Delete" />
      </form>
    </div>
    <div style="clear: both;"></div>`;

    let div = document.createElement( 'div' );
    div.innerHTML = html;

    let parent = document.getElementById( 'contacts' );
    parent.appendChild( div );
  }

  function displayAll()
  {
    sortContacts();
    contacts.forEach( display );
  }

  function deletePerson( form )
  {
    return confirm( `Do you wish to permanently delete contact ${form.name.value}?` );
  }
</script>

<div style="margin-left: auto; margin-right: auto; ">
  <h2>Manage Contacts</h2>
  <div>
    <div style="display:inline-block; float: left; padding: 10px;"><a href="/contacts/create" style="float: left;">Create Contact</a></div>
    <div style="display:inline-block; overflow: hidden; width: 100px;"></div>
    <div style="display:inline-block; float: right; padding: 10px;">
      <form name="search" method="post" action="/contacts/search">
      <input type="text" name="text" placeholder="Search by name..."/><input type="submit" value="Find"/>
      </form>
    </div>
    <div style="clear: both;"></div>
  </div>
  {% if searchText %}
  <h3>Search results for ({{ searchText }})</h3>
  {% endif %}
  <div id="contacts">
       <div class="viewUserContainer">
            <div class="TitleHeader">
               <h4>View User</h4>
            </div> <!--End of Title Header </div-->
            <!--Start of div view Users Multiline Select -->
            <div class="viewUsersMultilineSelect">
               <select multiple id="lstBoxselectUser_ViewUser">
                   <option> <script type="text/javascript">displayAll();</script></option>
                 
               </select>
               <br><br>
               <input type="submit"  value="Select User"  id="selectUserButton">
               <a href="/contacts/create"><input type="button" name="addUser" value="Add User" id="addUserButton"></a>
               <input type="submit" name="removeUser" value="Remove User" id="removeUserButton">
               
               <br>
            </div> <!--End of div viewUsersMultilineSelect -->
           
            <!--Start of div filterBy -->
            <div class="filterByInViewUsers">
               <h2 id="filterByHeader"> Filter By </h2>
               <fieldset>
                  <p id="instituteLabelInFilterBy"> Institute: </p>
                  <select class="commonCmbBox2CSS" name="institution" id="institution" >
                   <option></option>
                  </select>
                  <br>
                  <p id="instituteIDLabelInFilterBy"> Institute ID: </p>
                  <input type="text" name="instituteIDInput" placeholder="Name of the Institute" class="InstituteIdFilterTextBoxInFilterBy">
                  <br>
                  <input type="button" value="Apply Filter" class="commonBtnInViewPrograms"><br>
               </fieldset>
               <fieldset>
                  <p class="adminTypeLabelInFilterBy"> Admin Type: </p>
                  <select class="commonCmbBox2CSS">
                     
                     <option></option>
                  </select>
                  <input type="button" value="Apply Filter" class="commonBtnInViewPrograms">
               </fieldset>
               <fieldset>
                  <p id="UserIDLabelInFilterBy"> User ID: </p>
                  <input type="text" name="userIDInput" placeholder="Name of the user" class="selectUserTextBoxInFilterBy"><br>
                  <input type="submit" value="Search" name="searchButton" class="commonBtnInViewPrograms">
               </fieldset>
            </div> <!--End of div filterBy -->
           
         </div><!--viewUserContainer-->
    <script type="text/javascript">displayAll();</script>
  </div>
</div>
