<script type="text/javascript">
  let contacts = {{ contacts }};
  var institutions = [];
    
    function getInstitutions()
{
    let xhr = new XMLHttpRequest();
    xhr.open( 'POST', '/institutions' );
    xhr.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' );
    xhr.onload = function ()
    {
      if ( xhr.status === 200 )
      {
        console.log( xhr.responseText );
        institutions = JSON.parse( xhr.responseText );
        populateInstitutionsSelect();
      }
      else
      {
        console.log( `Unable to retrieve institution list.  Server returned status: ${xhr.status}` );
      }
    };
    xhr.send( '' );
}

  function sortContacts()
  {
    function compareInstitution( i1, i2 )
    {
      if ( i1.name < i2.name ) return -1;
      if ( i1.name > i2.name ) return 1;
      return 0;
    }
    function compareContact( c1, c2 )
    {
      if ( c1.name < c2.name ) return -1;
      if ( c1.name > c2.name ) return 1;
      if ( !isEmpty( c1.institution ) && !isEmpty( c2.institution ) )
      {
        return compareInstitution( c1.institution, c2.institution );
      }
      return 0;
    }
    contacts.sort( compareContact );
  }

  function display( contact )
  {
      let element = document.getElementById( 'lstBoxselectUser_ViewUser' );
      let option = document.createElement( 'option' );
      option.value = contact.id;
      option.textContent = contact.name;
      element.appendChild( option );
  }

  function displayAll()
  {
    sortContacts();
    contacts.forEach( display );
  }
  function deletePerson( form )
  {
    return confirm( `Do you wish to permanently delete contact ${form.name.value}?` );
  }
    
  function populateInstitutionsSelect()
    {
        let element = document.getElementById('institution');
        for (var i = 0; i < institutions.length; ++i)
            {
                let option = document.createElement( 'option' );
                option.value = institutions[i].id;
                option.textContent = institutions[i].name;
                element.appendChild( option );
            }
    }

    getInstitutions();
</script>

<div style="margin-left: auto; margin-right: auto; ">
    
  <h2>Manage Contacts</h2>
  <div>
    <!--div style="display:inline-block; float: left; padding: 10px;"><a href="/contacts/create" style="float: left;">Create Contact</a></div-->
    <div style="display:inline-block; overflow: hidden; width: 100px;"></div>
    <div style="display:inline-block; float: right; padding: 10px;">
      <form name="search" method="post" action="/contacts/search">
      <input type="text" name="text" placeholder="Search by name..."/><input type="submit" value="Find"/>
      </form>
    </div>
    <div style="clear: both;"></div>
  </div>
  {% if searchText %}
  <h3>Search results for ({{ searchText }})</h3>
  {% endif %}
  <div id="contacts">
       <div class="viewUserContainer">
            <div class="TitleHeader">
               <h4>View User</h4>
            </div> <!--End of Title Header </div-->
            <!--Start of div view Users Multiline Select -->
            <div class="viewUsersMultilineSelect">
               <select multiple id="lstBoxselectUser_ViewUser">
                   <script type="text/javascript">displayAll();</script>
               </select>
               <br><br>
               <input type="submit"  value="Select User"  id="selectUserButton">
               <a href="/contacts/create"><input type="button" name="addUser" value="Add User" id="addUserButton"></a>
               <input type="submit" name="removeUser" value="Remove User" id="removeUserButton">
               
               <br>
            </div> <!--End of div viewUsersMultilineSelect -->
           
            <!--Start of div filterBy -->
            <div class="filterByInViewUsers">
               <h2 id="filterByHeader"> Filter By </h2>
               <fieldset>
                  <p id="instituteLabelInFilterBy"> Institute: </p>
                  <select class="commonCmbBox2CSS" name="institution" id="institution" >
                   <option></option>
                  </select>
                  <br>
                  <p id="instituteIDLabelInFilterBy"> Institute Name: </p>
                  <input type="text" name="instituteIDInput" placeholder="Name of the Institute" class="InstituteIdFilterTextBoxInFilterBy">
                  <br>
                  <input type="button" value="Apply Filter" class="commonBtnInViewPrograms"><br>
               </fieldset>
               <fieldset>
                  <p class="roleLabelInFilterBy"> Role: </p>
                  <select name="role" id="role"  class="commonCmbBox2CSS"  {% if object.user %}{% else %}disabled{% endif %}>
                      <option value="-1" style="font-size: 16px;">Select Role</option>
                      {% for role in roles %}
                      <option value="{{ role.id }}" style="font-size: 16px;"
                              {% ifequal role.id object.user.role.id %}selected="selected" {% endifequal %}>
                        {{ role.role }}
                      </option>
                      {% endfor %}
                    </select>
                  <input type="button" value="Apply Filter" class="commonBtnInViewPrograms">
               </fieldset>
               <fieldset>
                 <form name="search" method="post" action="/contacts/search">
                        <p id="UserIDLabelInFilterBy"> User Name: </p><input type="text" name="text" class="selectUserTextBoxInFilterBy" placeholder="Search by name..."/>
                       <input type="submit"  class="commonBtnInViewPrograms" value="Find"/>
                    </form>
               </fieldset>
            </div> <!--End of div filterBy -->
           
         </div><!--viewUserContainer-->
  </div>
</div>
